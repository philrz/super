script: |
  super -s -I cte.spq -c 'select * from A A(x,y) join B B(x,y) using (y)'
  ! super -s -I cte.spq -c 'select * from A A(x,y) join B B(x,y) using (A.y)'
  ! super -s -I cte.spq -c 'select * from A A(x,y) join B B(x,z) using (y)'

inputs:
  - name: cte.spq
    data: |
      with A as (
        values (1,'a'), (2,'b')
      ),
      B as (
        values (3,'a'), (4,'b')
      )

outputs:
  - name: stdout
    data: |
      {y:"a",x:1,x_1:3}
      {y:"b",x:2,x_1:4}
  - name: stderr
    data: |
      parse error at line 1, column 46:
      select * from A A(x,y) join B B(x,y) using (A.y)
                                               === ^ ===
      column "y" in USING clause does not exist in right table at line 1, column 45:
      select * from A A(x,y) join B B(x,z) using (y)
                                                  ~
