spq: val[idx]

vector: true

input: |
  // array
  {val:[1,2,3,"foo"],idx:-1}
  {val:[1,2,3,"bar"],idx:1::uint8}
  {val:[1,2,3,"foo"],idx:-4}
  {val:[1,2,3,null],idx:3}
  {val:[1,2,3,"foo"],idx:-5}
  {val:null::[int64|string],idx:-5}
  {val:[1,2,3,"foo"],idx:null::int64}
  {val:[1,2,3,"foo"],idx:"hi"}
  {val:[1,2,3,"foo"],idx:9223372036854775808::uint64}
  // set
  {val:|[1,2,3,"foo"]|,idx:-1}
  {val:|[1,2,3,"bar"]|,idx:1}
  {val:|[1,2,3,"foo"]|,idx:-4}
  {val:[1,2,3,null],idx:3}
  {val:|[1,2,3,"foo"]|,idx:-5}
  {val:|[1,2,3,"foo"]|,idx:"hi"}
  // record
  {val:{a:"foo",b:"bar"},idx:"a"}
  {val:{a:"bar",b:"baz"},idx:"b"}
  {val:{a:"bar",b:null},idx:"b"}
  {val:{a:"foo",b:"bar"},idx:0}
  {val:{a:"foo",b:"bar"},idx:-1}
  {val:{a:"foo",b:"bar"},idx:1.}
  {val:{a:"bar",b:"baz"},idx:"doesnotexist"}
  // map
  {val:|{"foo":1,1:2}|,idx:"foo"}
  {val:|{"foo":1,1:2}|,idx:1}
  {val:|{"foo":1,1:2,"foo":2}|,idx:"foo"}
  {val:|{"foo":1,1:2}|,idx:"bar"}
  {val:|{"foo":1,"bar":127.0.0.1}|,idx:"bar"}

output: |
  "foo"
  2
  1
  null::int64
  error("missing")
  error("missing")
  error("missing")
  error({message:"index is not an integer",on:"hi"})
  error({message:"cannot cast to int64",on:9223372036854775808::uint64})::error({message:string,on:uint64})
  "foo"
  2
  1
  null::int64
  error("missing")
  error({message:"index is not an integer",on:"hi"})
  "foo"
  "baz"
  null
  "foo"
  "bar"
  error({message:"invalid value for record index",on:1.})
  error("missing")
  1
  2
  1
  error("missing")
  127.0.0.1

---

spq: |
  fn returnArray(): ([1])
  values returnArray()[0],
    cast(["1"],<[int64]>)[0],
    [1][0],
    |[1]|[0],
    |{1:1}|[1],
    {x:1}["x"]

vector: true

input: |
  null
  
output: |
  1
  1
  1
  1
  1
  1

---

# Test index on named values.
spq: values this[1],this["x"]

vector: true

input: |
  [1,2,3]::=foo
  |[4,5,6]|::=bar
  |{1:"foo"}|::=baz
  {"x":123}::=bap
  
output: |
  2
  error("missing")
  5
  error("missing")
  "foo"
  error("missing")
  error("missing")
  123
